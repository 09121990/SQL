SELECT
      --"source"."BILLDATE" "BILLDATE",
     SUM( "source"."RECAMOUNT") "RECAMOUNT"
    FROM
      (
        SELECT
          "BILLDATE",
          "RECAMOUNT"
        FROM
          "LTHMS"."INVGRPSINGLECHARGEDETAIL"
        union all
        SELECT
          "BILLDATE",
          "RECAMOUNT"
        FROM
          "LTHMS"."OPTCHARGEDETAIL"
        union all
        SELECT
          "BILLDATE",
          "RECAMOUNT"
        FROM
          "LTHMS"."PHARMACYTRANSACTIONDETAIL"
        UNION all
        SELECT
          "BILLDATE",
          "RECAMOUNT"
        FROM
          "LTHMS"."PHARMACYTRANDETAILGUL"
        UNION all
        SELECT
          "BILLDATE",
          "RECAMOUNT"
        FROM
          "LTHMS"."PHARMACYTRANDETAILUTR"
        UNION all
        SELECT
          "RCPTDATE" AS "BILLDATE",
          "RECAMOUNT"
        FROM
          "LTHMS"."RECEIPTDETAIL"
      ) "source"
   
WHERE
      "source"."BILLDATE" BETWEEN date '2024-01-01'
     
   AND date '2024-01-31';
   -----------------------------------
   SELECT 
    -- Aggregated revenue amount
    SUM("source"."RECAMOUNT") AS "Total Revenue"
FROM (
    -- Individual revenue sources combined using UNION ALL
    SELECT "BILLDATE", "RECAMOUNT" FROM "LTHMS"."INVGRPSINGLECHARGEDETAIL"
    UNION ALL
    SELECT "BILLDATE", "RECAMOUNT" FROM "LTHMS"."OPTCHARGEDETAIL"
    UNION ALL
  SELECT "BILLDATE", "RECAMOUNT" FROM "LTHMS"."PHARMACYTRANSACTIONDETAIL"
    UNION ALL
    SELECT "BILLDATE", "RECAMOUNT" FROM "LTHMS"."PHARMACYTRANDETAILGUL"
    UNION ALL
    SELECT "BILLDATE", "RECAMOUNT" FROM "LTHMS"."PHARMACYTRANDETAILUTR"
    UNION ALL 
    SELECT "RCPTDATE" AS "BILLDATE", "RECAMOUNT" FROM "LTHMS"."RECEIPTDETAIL"
) "source"
WHERE 
    "source"."BILLDATE" BETWEEN DATE '2025-01-01' AND DATE '2025-01-31';
---------------------------------3
   SELECT 
    -- Aggregated revenue amount
    SUM("source"."RECAMOUNT") AS "Total Revenue"
FROM (
    -- Individual revenue sources combined using UNION ALL
    SELECT "BILLDATE", "RECAMOUNT" FROM "LTHMS"."INVCHARGEDETAIL"
    UNION ALL
    SELECT "BILLDATE", "RECAMOUNT" FROM "LTHMS"."OPTCHARGEDETAIL"
    UNION ALL

    SELECT "RCPTDATE" AS "BILLDATE", "RECAMOUNT" FROM "LTHMS"."RECEIPTDETAIL"
) "source"
WHERE 
    "source"."BILLDATE" BETWEEN DATE '2025-01-01' AND DATE '2025-01-31';
    --------------------------------4
    SELECT 
    "source"."BRANCH",
    SUM("source"."RECAMOUNT") AS "Total Revenue"
FROM (
    SELECT "BILLDATE", "RECAMOUNT", "BRANCH" FROM "LTHMS"."INVCHARGEDETAIL"
    UNION ALL
    SELECT "BILLDATE", "RECAMOUNT", "BRANCH" FROM "LTHMS"."OPTCHARGEDETAIL"
    UNION ALL
    SELECT "RCPTDATE" AS "BILLDATE", "RECAMOUNT", "BRANCH" FROM "LTHMS"."RECEIPTDETAIL" -- No BRANCH column
) "source"
WHERE 
    "source"."BILLDATE" BETWEEN DATE '2025-01-01' AND DATE '2025-01-31'
GROUP BY 
    "source"."BRANCH"
ORDER BY 
    "Total Revenue" DESC;
    ------------------
    select BRANCH, sum(RECAMOUNT) from INVCHARGEDETAIL
    where BILLDATE BETWEEN DATE '2025-02-01' AND DATE '2025-02-28'
   --AND BRANCH NOT IN ('Banani', 'Gulshan', 'Uttara');
     group by BRANCH;
    
SELECT BRANCH,sum(RECAMOUNT)
FROM OPTCHARGEDETAIL
WHERE BILLDATE BETWEEN DATE '2025-02-01' AND DATE '2025-02-28'
  --AND BRANCH NOT IN ('Banani', 'Gulshan', 'Uttara');
  group by BRANCH;
---------------------------------------

SELECT 
    "source"."BRANCH",
    SUM(CASE WHEN "source"."SOURCE" = 'INVCHARGEDETAIL' THEN "source"."RECAMOUNT" ELSE 0 END) AS "Lab Revenue",
    SUM(CASE WHEN "source"."SOURCE" = 'OPTCHARGEDETAIL' THEN "source"."RECAMOUNT" ELSE 0 END) AS "Procedure_Revenue",
    SUM(CASE WHEN "source"."SOURCE" = 'RECEIPTDETAIL' THEN "source"."RECAMOUNT" ELSE 0 END) AS "Consultation_Revenue",
    SUM("source"."RECAMOUNT") AS "Total Revenue"
FROM (
    SELECT "BILLDATE", "RECAMOUNT", "BRANCH", 'INVCHARGEDETAIL' AS "SOURCE" FROM "LTHMS"."INVCHARGEDETAIL"
    UNION ALL
    SELECT "BILLDATE", "RECAMOUNT", "BRANCH", 'OPTCHARGEDETAIL' AS "SOURCE" FROM "LTHMS"."OPTCHARGEDETAIL"
    UNION ALL
    SELECT "RCPTDATE" AS "BILLDATE", "RECAMOUNT", "BRANCH", 'RECEIPTDETAIL' AS "SOURCE" FROM "LTHMS"."RECEIPTDETAIL"
) "source"
WHERE 
    "source"."BILLDATE" BETWEEN DATE '2025-01-01' AND DATE '2025-01-31'
GROUP BY 
    "source"."BRANCH"
ORDER BY 
    "Total Revenue" DESC;
---------------------------
SELECT 
    "BRANCH",
    SUM(CASE WHEN "SOURCE" = 'INVCHARGEDETAIL' THEN "RECAMOUNT" ELSE 0 END) AS "Lab Revenue",
    SUM(CASE WHEN "SOURCE" = 'OPTCHARGEDETAIL' THEN "RECAMOUNT" ELSE 0 END) AS "Procedure Revenue",
    SUM(CASE WHEN "SOURCE" = 'RECEIPTDETAIL' THEN "RECAMOUNT" ELSE 0 END) AS "Consultation Revenue",
    SUM("RECAMOUNT") AS "Total Revenue"
FROM (
    SELECT "BILLDATE", "RECAMOUNT", "BRANCH", 'INVCHARGEDETAIL' AS "SOURCE" FROM "LTHMS"."INVCHARGEDETAIL"
    UNION ALL
    SELECT "BILLDATE", "RECAMOUNT", "BRANCH", 'OPTCHARGEDETAIL' AS "SOURCE" FROM "LTHMS"."OPTCHARGEDETAIL"
    UNION ALL
    SELECT "RCPTDATE" AS "BILLDATE", "RECAMOUNT", "BRANCH", 'RECEIPTDETAIL' AS "SOURCE" FROM "LTHMS"."RECEIPTDETAIL"
) "source"
WHERE 
    "BILLDATE" BETWEEN DATE '2025-01-01' AND DATE '2025-01-31'
GROUP BY ROLLUP("BRANCH")
ORDER BY "BRANCH" NULLS LAST;
----------------------------
SELECT 
    NVL("BRANCH", 'All Branch') AS "BRANCH",
    SUM(CASE WHEN "SOURCE" = 'INVCHARGEDETAIL' THEN "RECAMOUNT" ELSE 0 END) AS "Lab Revenue",
    SUM(CASE WHEN "SOURCE" = 'OPTCHARGEDETAIL' THEN "RECAMOUNT" ELSE 0 END) AS "Procedure Revenue",
    SUM(CASE WHEN "SOURCE" = 'RECEIPTDETAIL' THEN "RECAMOUNT" ELSE 0 END) AS "Consultation Revenue",
    SUM("RECAMOUNT") AS "Total Revenue"
FROM (
    SELECT "BILLDATE", "RECAMOUNT", "BRANCH", 'INVCHARGEDETAIL' AS "SOURCE" FROM "LTHMS"."INVCHARGEDETAIL"
    UNION ALL
    SELECT "BILLDATE", "RECAMOUNT", "BRANCH", 'OPTCHARGEDETAIL' AS "SOURCE" FROM "LTHMS"."OPTCHARGEDETAIL"
    UNION ALL
    SELECT "RCPTDATE" AS "BILLDATE", "RECAMOUNT", "BRANCH", 'RECEIPTDETAIL' AS "SOURCE" FROM "LTHMS"."RECEIPTDETAIL"
) "source"
WHERE 
    "BILLDATE" BETWEEN DATE '2025-01-01' AND DATE '2025-01-31'
GROUP BY ROLLUP("BRANCH")
ORDER BY "BRANCH" NULLS LAST;
------------------------------
SELECT 
    NVL("BRANCH", 'All Branch') AS "BRANCH",
    SUM(CASE WHEN "SOURCE" = 'INVCHARGEDETAIL' THEN "RECAMOUNT" ELSE 0 END) AS "Lab Revenue",
    SUM(CASE WHEN "SOURCE" = 'OPTCHARGEDETAIL' THEN "RECAMOUNT" ELSE 0 END) AS "Procedure Revenue",
    SUM(CASE WHEN "SOURCE" = 'RECEIPTDETAIL' THEN "RECAMOUNT" ELSE 0 END) AS "Consultation Revenue",
    SUM("RECAMOUNT") AS "Total Revenue"
FROM (
    SELECT "BILLDATE", "RECAMOUNT", "BRANCH", 'INVCHARGEDETAIL' AS "SOURCE" FROM "LTHMS"."INVCHARGEDETAIL"
    UNION ALL
    SELECT "BILLDATE", "RECAMOUNT", "BRANCH", 'OPTCHARGEDETAIL' AS "SOURCE" FROM "LTHMS"."OPTCHARGEDETAIL"
    UNION ALL
    SELECT "RCPTDATE" AS "BILLDATE", "RECAMOUNT", "BRANCH", 'RECEIPTDETAIL' AS "SOURCE" FROM "LTHMS"."RECEIPTDETAIL"
) "source"
WHERE 
    "BILLDATE" BETWEEN DATE '2025-01-01' AND DATE '2025-01-31'
GROUP BY ROLLUP("BRANCH")
ORDER BY 
    CASE 
        WHEN NVL("BRANCH", 'All Branch') = 'All Branch' THEN 1 
        ELSE 0 
    END,
    "BRANCH";
  -------------------------- this code working slow
SELECT 
    -- Use NVL to handle NULL values for the branch column, substituting with 'All Branch' if NULL
    NVL("BRANCH", 'All Branch') AS "BRANCH",

    -- Sum of "RECAMOUNT" where the source is 'INVCHARGEDETAIL' (Lab Revenue)
    SUM(CASE WHEN "SOURCE" = 'INVCHARGEDETAIL' THEN "RECAMOUNT" ELSE 0 END) AS "Lab Revenue",
    SUM(CASE WHEN "SOURCE" = 'OPTCHARGEDETAIL' THEN "RECAMOUNT" ELSE 0 END) AS "Procedure Revenue",
    SUM(CASE WHEN "SOURCE" = 'RECEIPTDETAIL' THEN "RECAMOUNT" ELSE 0 END) AS "Consultation Revenue",
    -- Total sum of all "RECAMOUNT" across all sources (Total Revenue)
    SUM("RECAMOUNT") AS "Total Revenue"

FROM (
    -- Select data from INVCHARGEDETAIL, specify the 'SOURCE' as 'INVCHARGEDETAIL'
    SELECT "BILLDATE", "RECAMOUNT", "BRANCH", 'INVCHARGEDETAIL' AS "SOURCE"
    FROM "LTHMS"."INVCHARGEDETAIL"
    WHERE "BILLDATE" BETWEEN DATE '2025-01-01' AND DATE '2025-01-31'

    UNION ALL

    -- Select data from OPTCHARGEDETAIL, specify the 'SOURCE' as 'OPTCHARGEDETAIL'
    SELECT "BILLDATE", "RECAMOUNT", "BRANCH", 'OPTCHARGEDETAIL' AS "SOURCE"
    FROM "LTHMS"."OPTCHARGEDETAIL"
    WHERE "BILLDATE" BETWEEN DATE '2025-01-01' AND DATE '2025-01-31'

    UNION ALL

    -- Select data from RECEIPTDETAIL, specify the 'SOURCE' as 'RECEIPTDETAIL'
    SELECT "RCPTDATE" AS "BILLDATE", "RECAMOUNT", "BRANCH", 'RECEIPTDETAIL' AS "SOURCE"
    FROM "LTHMS"."RECEIPTDETAIL"
    WHERE "RCPTDATE" BETWEEN DATE '2025-01-01' AND DATE '2025-01-31'
) "source"

-- GROUP BY with ROLLUP to create summary data for each branch and a total row
GROUP BY ROLLUP("BRANCH")

-- Custom ORDER BY to ensure that the total ('All Branch') comes at the end
ORDER BY 
    CASE 
        -- If the branch is 'All Branch', place it at the bottom of the result set
        WHEN NVL("BRANCH", 'All Branch') = 'All Branch' THEN 1 
        ELSE 0 
    END,
    -- Order by branch alphabetically for other rows
    "BRANCH";
--------------------------------
